<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Focus Studio â€” Pomodoro with Sand Timer</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#071025; --card:#0e1724; --glass: rgba(255,255,255,0.03);
    --accent:#00D1FF; --accent-2:#FF6B6B; --muted:#9FB4C8;
    --radius:14px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Arial;background:
    radial-gradient(1200px 600px at 10% 10%, rgba(0,209,255,0.03), transparent 8%),
    radial-gradient(700px 400px at 90% 90%, rgba(255,107,107,0.02), transparent 6%),
    var(--bg); color:#e6f0ff; -webkit-font-smoothing:antialiased;}
  .hero-bg { position:fixed; inset:0; z-index:-1; opacity:0.06; background-size:cover; background-position:center;
    background-image: url("/mnt/data/An_elite_cyber_202511222205 (1).jpeg"); filter: blur(6px) saturate(80%); }
  .container{max-width:1100px;margin:28px auto;padding:18px; display:grid; grid-template-columns:1fr 380px; gap:20px}
  @media (max-width:960px){ .container{grid-template-columns:1fr;padding:12px} }
  .topbar{display:flex;justify-content:space-between; align-items:center; margin-bottom:8px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:#031025;font-weight:800}
  .title{font-weight:700}
  .subtitle{color:var(--muted);font-size:13px}
  .card{background:linear-gradient(180deg,var(--card),#0b1220); padding:20px;border-radius:var(--radius); box-shadow:0 10px 30px rgba(2,6,23,0.7); border:1px solid rgba(255,255,255,0.03)}
  .timer-wrap{display:flex;gap:20px;align-items:center;flex-wrap:wrap; justify-content:center}
  .ring{width:300px;height:300px;position:relative;display:grid;place-items:center}
  @media (max-width:480px){ .ring{width:240px;height:240px} .time{font-size:38px} }
  .time{font-size:56px;font-weight:800;letter-spacing:1px}
  .session{color:var(--muted);margin-top:6px}
  .controls{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;justify-content:center}
  .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
  .btn.primary{background:linear-gradient(90deg,var(--accent),#28b7ff);color:#031027}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .presets{display:flex;gap:8px;justify-content:center;margin-top:12px;flex-wrap:wrap}
  .chip{padding:8px 12px;border-radius:999px;background:var(--glass);cursor:pointer;color:var(--muted)}
  .chip.active{background:linear-gradient(90deg,var(--accent),#28b7ff); color:#031027; font-weight:800}
  /* tasks */
  .task-list{margin-top:12px;display:flex;flex-direction:column;gap:10px; max-height:340px;overflow:auto;padding-right:6px}
  .task{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.02)}
  .task .title{font-weight:700}
  .task .meta{margin-left:auto;color:var(--muted);font-size:13px}
  .add-row{display:flex;gap:8px;margin-top:10px}
  input, textarea {background:transparent;border:1px solid rgba(255,255,255,0.03);padding:10px;border-radius:8px;color:inherit}
  .rightcol{display:flex;flex-direction:column;gap:16px}
  .stat-grid{display:flex;gap:10px}
  .stat{flex:1;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));text-align:center}
  .chart{display:flex;gap:6px;align-items:end;height:90px;margin-top:10px}
  .bar{flex:1;border-radius:6px;background:linear-gradient(180deg, rgba(2,6,23,0.2), rgba(2,6,23,0.5));display:flex;align-items:flex-end;justify-content:center}
  .small{color:var(--muted);font-size:13px}
  footer{color:var(--muted);text-align:center;margin-top:14px}
  .kbd{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:6px;font-weight:700}

  /* HOURGLASS / SAND STYLES (REPLACES CIRCLE) */
  .hourglass {
    width: 180px;
    height: 260px;
    position: relative;
    display: grid;
    place-items: center;
    perspective: 800px;
  }
  .glass-frame {
    width: 140px;
    height: 220px;
    border-radius: 12px;
    position: relative;
    overflow: visible;
    display:flex;align-items:center;justify-content:center;
  }
  /* outer outline */
  .glass-frame::before {
    content: "";
    position:absolute; inset:0;
    border-radius: 12px;
    border: 6px solid rgba(255,255,255,0.06);
    box-shadow: 0 8px 30px rgba(0,0,0,0.6), inset 0 2px 8px rgba(255,255,255,0.02);
  }

  /* top & bottom sand containers */
  .sand-top, .sand-bottom {
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    width: 86%;
    border-radius: 6px;
    overflow: hidden;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  }
  .sand-top {
    top: 18px;
    height: 45%;
    clip-path: polygon(0 0,100% 0,60% 50%,40% 50%);
    display:flex;align-items:flex-end;justify-content:center;
  }
  .sand-bottom {
    bottom: 18px;
    height: 0%;
    clip-path: polygon(40% 50%,60% 50%,100% 100%,0 100%);
    display:flex;align-items:flex-start;justify-content:center;
  }

  /* the actual sand layers inside top and bottom */
  .sand-fill-top, .sand-fill-bottom {
    width:100%;
    background: linear-gradient(180deg, #ffd27f, #ffbb55);
    transition: height 1s linear;
  }
  .sand-fill-top { height:100%; transform-origin: bottom; }
  .sand-fill-bottom { height:0%; transform-origin: top; }

  /* the falling stream */
  .stream {
    position:absolute;
    top: 50%;
    left:50%;
    transform:translate(-50%,-50%);
    width:6px;
    border-radius:6px;
    background: linear-gradient(180deg,#ffebc9,#ffd27f);
    height:0%;
    transition: height 0.25s linear, opacity 0.25s linear;
    box-shadow: 0 3px 8px rgba(255,200,120,0.2);
  }

  /* little particles animation (CSS pseudo) */
  .grain {
    position:absolute;
    width:3px;height:6px;border-radius:50%;
    background: #ffdd99; opacity:0.9;
    animation: fall 1.2s linear infinite;
  }
  @keyframes fall {
    0%{ transform: translateY(-40px) scaleY(0.6); opacity:0 }
    30%{ opacity:1 }
    100%{ transform: translateY(40px) scaleY(1); opacity:0 }
  }

  /* responsive tweaks */
  @media (max-width:480px){
    .hourglass{ width:140px;height:200px}
    .glass-frame{ width:110px;height:180px}
  }
</style>
</head>
<body>
  <div class="hero-bg" aria-hidden="true"></div>

  <div style="max-width:1100px;margin:16px auto;padding:12px">
    <div class="topbar" style="display:flex;justify-content:space-between;align-items:center">
      <div class="brand" style="display:flex;align-items:center;gap:12px">
        <div class="logo">FS</div>
        <div>
          <div class="title">Focus Studio</div>
          <div class="subtitle">Pomodoro â€” hourglass focus</div>
        </div>
      </div>
      <div class="small">Shortcuts: <span class="kbd">Space</span> start/pause â€¢ <span class="kbd">R</span> reset â€¢ <span class="kbd">N</span> new task</div>
    </div>
  </div>

  <main class="container" role="main">
    <section class="card" aria-labelledby="timerHeading">
      <h2 id="timerHeading" style="margin:0 0 12px 0">Pomodoro Timer</h2>

      <div class="timer-wrap">
        <!-- HOURGLASS (replaces circle) -->
        <div class="ring" id="ringWrap" role="region" aria-live="polite" aria-label="Pomodoro hourglass">
          <div class="hourglass" aria-hidden="false">
            <div class="glass-frame">
              <div class="sand-top" id="sandTop">
                <div class="sand-fill-top" id="sandFillTop"></div>
              </div>
              <div class="sand-bottom" id="sandBottom">
                <div class="sand-fill-bottom" id="sandFillBottom"></div>
              </div>
              <div class="stream" id="sandStream"></div>

              <!-- decorative grains (not necessary, a few clones) -->
              <div class="grain" style="left:48%; top:48%; animation-delay:0s"></div>
              <div class="grain" style="left:52%; top:48%; animation-delay:0.2s"></div>
              <div class="grain" style="left:50%; top:50%; animation-delay:0.4s"></div>
            </div>
          </div>

          <div style="position:absolute;text-align:center">
            <div class="time" id="display">25:00</div>
            <div class="session" id="sessionLabel">Work â€¢ Pomodoro 1 of 4</div>

            <div class="controls">
              <button id="start" class="btn primary">Start</button>
              <button id="pause" class="btn ghost" style="display:none">Pause</button>
              <button id="reset" class="btn ghost">Reset</button>
            </div>

            <div class="presets" style="margin-top:10px">
              <div class="chip" data-min="25">Work 25</div>
              <div class="chip" data-min="5">Short 5</div>
              <div class="chip" data-min="15">Long 15</div>
              <div class="chip" id="custom">Custom</div>
            </div>
            <div style="margin-top:8px" class="small">Volume: <span id="volLabel">80%</span></div>
            <input id="volume" type="range" min="0" max="100" value="80" style="width:160px;margin-top:6px">
          </div>
        </div>

        <div style="flex:1;min-width:280px">
          <h3 style="margin-top:0">Tasks</h3>
          <div class="task-area card" style="padding:12px;">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div class="small">Focus List</div>
              <div class="small">Today: <strong id="todayCount">0</strong></div>
            </div>

            <div class="add-row" style="margin-top:10px">
              <input id="newTask" placeholder="Add task and press Enter" aria-label="Add task">
              <button id="addBtn" class="btn">Add</button>
            </div>

            <div class="task-list" id="tasks"></div>
          </div>

          <div style="margin-top:12px" class="card small">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div><strong>Focus Mode</strong><div class="small">Hide right column while running</div></div>
              <label><input type="checkbox" id="focusToggle"></label>
            </div>
          </div>
        </div>
      </div>

      <footer class="small">Tip: Use <span class="kbd">Space</span> to start/pause. Focus for 25 minutes, reward with a break!</footer>
    </section>

    <aside class="rightcol">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Stats</strong><div class="small">Track progress</div></div>
          <div><button id="export" class="btn ghost">Export CSV</button></div>
        </div>

        <div class="stat-grid" style="margin-top:12px">
          <div class="stat"><div class="small">Today</div><div style="font-weight:800;font-size:20px" id="statToday">0</div></div>
          <div class="stat"><div class="small">Streak</div><div style="font-weight:800;font-size:20px;color:var(--accent-2)" id="statStreak">0</div></div>
        </div>

        <div style="margin-top:10px" class="small">Last 7 days</div>
        <div class="chart" id="chart"></div>
      </div>

      <div class="card small">
        <strong>Settings</strong>
        <div style="margin-top:10px" class="small">
          <label>Work <input id="sWork" type="number" min="5" max="90" value="25" style="width:70px;margin-left:8px"></label>
        </div>
        <div style="margin-top:8px" class="small">
          <label>Short <input id="sShort" type="number" min="1" max="30" value="5" style="width:70px;margin-left:8px"></label>
        </div>
        <div style="margin-top:8px" class="small">
          <label>Long <input id="sLong" type="number" min="5" max="60" value="15" style="width:70px;margin-left:8px"></label>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button id="save" class="btn">Save</button>
          <button id="clear" class="btn ghost">Reset Data</button>
        </div>
      </div>
    </aside>
  </main>

<script>
/* ===== Pomodoro with Sand Timer â€” Full single-file implementation ===== */

/* ---------- State ---------- */
let prefs = {work:25, short:5, long:15};
let mode = 'work';
let total = prefs.work * 60;
let remaining = total;
let running = false;
let timerId = null;
let pomodoroCount = 0;
const cycle = 4;
let sessionsToday = 0;
let streak = 0;
let weekly = [0,0,0,0,0,0,0]; // Sun-Sat

/* ---------- DOM ---------- */
const display = document.getElementById('display');
const sessionLabel = document.getElementById('sessionLabel');
const startBtn = document.getElementById('start');
const pauseBtn = document.getElementById('pause');
const resetBtn = document.getElementById('reset');
const chips = document.querySelectorAll('.chip');
const newTask = document.getElementById('newTask');
const addBtn = document.getElementById('addBtn');
const tasksEl = document.getElementById('tasks');
const todayCountEl = document.getElementById('todayCount');
const statToday = document.getElementById('statToday');
const statStreak = document.getElementById('statStreak');
const chartEl = document.getElementById('chart');
const focusToggle = document.getElementById('focusToggle');
const rightCol = document.querySelector('.rightcol');
const volume = document.getElementById('volume');
const volLabel = document.getElementById('volLabel');
const exportBtn = document.getElementById('export');

/* ---------- Sand Elements ---------- */
const sandFillTop = document.getElementById('sandFillTop');
const sandFillBottom = document.getElementById('sandFillBottom');
const sandStream = document.getElementById('sandStream');

/* ---------- Audio ---------- */
let audioCtx = null;
let masterGain = null;
function ensureAudio(){ if(!audioCtx){ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); masterGain = audioCtx.createGain(); masterGain.gain.value = volume.value/100; masterGain.connect(audioCtx.destination); } }
volume.addEventListener('input', ()=>{ volLabel.textContent = volume.value + '%'; if(masterGain) masterGain.gain.value = volume.value/100; });
volLabel.textContent = volume.value + '%';

function beep(f=880,d=0.08){
  ensureAudio();
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = 'sine'; o.frequency.value = f;
  o.connect(g); g.connect(masterGain);
  const now = audioCtx.currentTime;
  g.gain.value = 0;
  g.gain.linearRampToValueAtTime(0.8, now + 0.01);
  g.gain.linearRampToValueAtTime(0.001, now + d + 0.02);
  o.start(now); o.stop(now + d + 0.03);
}
function chime(){ ensureAudio(); const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type='triangle'; o.frequency.value=440; o.connect(g); g.connect(masterGain); const n = audioCtx.currentTime; g.gain.setValueAtTime(0, n); g.gain.linearRampToValueAtTime(0.7, n+0.02); o.frequency.exponentialRampToValueAtTime(880, n+0.6); g.gain.linearRampToValueAtTime(0.001, n+1.2); o.start(n); o.stop(n+1.3); }

/* ---------- Persistence ---------- */
const KEY = 'pomodoro_sand_v1';
function saveAll(){
  const payload = {prefs, sessionsToday, streak, weekly, tasks: getTasks()};
  localStorage.setItem(KEY, JSON.stringify(payload));
}
function loadAll(){
  const raw = localStorage.getItem(KEY);
  if(!raw) return;
  try{
    const p = JSON.parse(raw);
    prefs = p.prefs || prefs;
    sessionsToday = p.sessionsToday || sessionsToday;
    streak = p.streak || streak;
    weekly = p.weekly || weekly;
    if(p.tasks) localStorage.setItem(KEY + '-tasks', JSON.stringify(p.tasks));
  }catch(e){}
}
loadAll();

/* ---------- Timer ---------- */
function setMode(m, customMinutes){
  mode = m;
  const mins = customMinutes || (m==='work'?prefs.work:(m==='short'?prefs.short:prefs.long));
  total = mins*60;
  remaining = total;
  updateDisplay();
  updateLabel();
  updateSand(); // set sand to full top
  highlightChips();
}
function updateDisplay(){
  const mm = String(Math.floor(remaining/60)).padStart(2,'0');
  const ss = String(remaining%60).padStart(2,'0');
  display.textContent = `${mm}:${ss}`;
}
function updateLabel(){
  sessionLabel.textContent = `${capitalize(mode)} â€¢ Pomodoro ${Math.min(pomodoroCount+1, cycle)} of ${cycle}`;
}
function updateSand(){
  // fraction elapsed 0..1
  const elapsed = (total - remaining) / total;
  const topPercent = Math.max(0, Math.round(50 * (1 - elapsed))); // 50% top -> 0
  const bottomPercent = Math.max(0, Math.round(50 * elapsed));    // 0 -> 50%
  // stream size proportional to progress (small when nearly finished)
  const streamHeight = Math.max(0, Math.round(50 * Math.min(1, elapsed*1.2)));
  sandFillTop.style.height = topPercent + '%';
  sandFillBottom.style.height = bottomPercent + '%';
  sandStream.style.height = (running ? streamHeight + '%' : '0%');
  sandStream.style.opacity = running ? (streamHeight>2 ? '1' : '0.6') : '0';
}
function tick(){
  if(!running) return;
  remaining--;
  if(remaining <= 0){
    onSessionEnd();
    return;
  }
  if(remaining % 60 === 0) beep(880,0.04);
  updateDisplay();
  updateSand();
}
function startTimer(){
  if(!audioCtx) ensureAudio(); // must be initiated via user gesture, start button does that
  if(running) return;
  running = true;
  startBtn.style.display='none';
  pauseBtn.style.display='inline-block';
  timerId = setInterval(tick,1000);
  beep(880,0.06);
  updateSand();
  applyFocus(true);
}
function pauseTimer(){
  if(!running) return;
  running = false;
  clearInterval(timerId);
  startBtn.style.display='inline-block';
  pauseBtn.style.display='none';
  beep(660,0.05);
  updateSand();
  applyFocus(false);
}
function resetTimer(){
  pauseTimer();
  setMode('work');
  pomodoroCount = 0;
  updateAllUI();
  beep(720,0.05);
  resetSand();
}

/* ---------- Session end ---------- */
function onSessionEnd(){
  pauseTimer();
  chime();
  if(mode==='work'){
    pomodoroCount++;
    sessionsToday++;
    const day = new Date().getDay();
    weekly[day] = (weekly[day]||0) + 1;
    assignPomodoroToTask();
    streak = Math.max(streak, sessionsToday);
    saveAll();
    if(pomodoroCount % cycle === 0) setMode('long'); else setMode('short');
  } else {
    setMode('work');
  }
  updateAllUI();
  resetSand(); // reset stream briefly after end, top/bottom already updated by updateSand on setMode
}

/* ---------- Helpers ---------- */
function capitalize(s){ return s.charAt(0).toUpperCase() + s.slice(1); }
function applyFocus(on){ if(focusToggle.checked || on){ rightCol.style.transition='opacity .25s'; rightCol.style.opacity = on? '0.06' : '1'; } else rightCol.style.opacity='1'; }

/* ---------- Presets ---------- */
chips.forEach(c=>{
  c.addEventListener('click',()=>{
    const m = c.dataset.min;
    if(m) setMode( m==prefs.work ? 'work' : (m==prefs.short ? 'short' : 'long') );
    else {
      const val = prompt('Custom minutes (1-180):');
      const n = parseInt(val);
      if(n>0 && n<=180) setMode('work', n);
    }
  });
});
function highlightChips(){ chips.forEach(c=>{ c.classList.remove('active'); if(c.dataset.min == prefs.work && mode==='work') c.classList.add('active'); if(c.dataset.min == prefs.short && mode==='short') c.classList.add('active'); if(c.dataset.min == prefs.long && mode==='long') c.classList.add('active'); if(c.id==='custom' && mode==='work' && total !== prefs.work*60) c.classList.add('active'); }); }

/* ---------- Tasks ---------- */
function getTasks(){ const raw = localStorage.getItem(KEY + '-tasks'); if(!raw) return []; try{return JSON.parse(raw);}catch{ return []; } }
function saveTasks(list){ localStorage.setItem(KEY + '-tasks', JSON.stringify(list)); saveAll(); renderTasks(); }
function addTask(title){ if(!title) return; const t = getTasks(); t.unshift({id:Date.now().toString(),title,created:Date.now(),pomodoros:0,done:false}); saveTasks(t); }
function toggleTaskDone(id){ const t = getTasks().map(x=> x.id===id ? {...x,done:!x.done} : x); saveTasks(t); }
function incTaskPom(id){ const t = getTasks().map(x=> x.id===id ? {...x,pomodoros:(x.pomodoros||0)+1} : x); saveTasks(t); }
function delTask(id){ const t = getTasks().filter(x=> x.id!==id); saveTasks(t); }
function assignPomodoroToTask(){ const tasks = getTasks(); const idx = tasks.findIndex(x=> !x.done); if(idx>=0){ tasks[idx].pomodoros = (tasks[idx].pomodoros||0)+1; saveTasks(tasks);} else saveAll(); }
function renderTasks(){ const list = getTasks(); tasksEl.innerHTML = ''; list.forEach(t=>{ const el = document.createElement('div'); el.className='task'; el.innerHTML = `<input type="checkbox" ${t.done ? 'checked' : ''} aria-label="done"><div class="title">${escapeHtml(t.title)}</div><div class="meta">${t.pomodoros||0} pomodoro</div><div style="margin-left:8px;display:flex;gap:8px"><button data-id="${t.id}" class="inc btn ghost">+1</button><button data-id="${t.id}" class="del btn ghost">ðŸ—‘</button></div>`; el.querySelector('input[type="checkbox"]').addEventListener('change', ()=> toggleTaskDone(t.id)); el.querySelector('.inc').addEventListener('click', (e)=> incTaskPom(e.target.dataset.id)); el.querySelector('.del').addEventListener('click', (e)=> delTask(e.target.dataset.id)); tasksEl.appendChild(el); }); }

/* ---------- Chart & Stats ---------- */
function renderChart(){ chartEl.innerHTML = ''; const max = Math.max(...weekly,1); for(let i=0;i<7;i++){ const val = weekly[i] || 0; const h = Math.round((val / max) * 80); const outer = document.createElement('div'); outer.className='bar'; const inner = document.createElement('div'); inner.style.width='100%'; inner.style.height = h + 'px'; inner.style.background = val ? 'linear-gradient(180deg,var(--accent),var(--accent-2))' : 'rgba(255,255,255,0.02)'; outer.appendChild(inner); chartEl.appendChild(outer); } }
function updateAllUI(){ todayCountEl.textContent = sessionsToday; statToday.textContent = sessionsToday; statStreak.textContent = streak; renderChart(); renderTasks(); updateLabel(); updateDisplay(); highlightChips(); }

/* ---------- Misc ---------- */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[c])); }

/* ---------- Keyboard ---------- */
document.addEventListener('keydown', (e)=>{ if(e.code==='Space'){ e.preventDefault(); running ? pauseTimer() : startTimer(); } if(e.key==='r' || e.key==='R'){ resetTimer(); } if(e.key==='n' || e.key==='N'){ newTask.focus(); } });

/* ---------- UI Events ---------- */
startBtn.addEventListener('click', ()=> { startTimer(); });
pauseBtn.addEventListener('click', ()=> { pauseTimer(); });
resetBtn.addEventListener('click', ()=> { resetTimer(); });
addBtn.addEventListener('click', ()=> { addTask(newTask.value.trim()); newTask.value=''; newTask.focus(); });
newTask.addEventListener('keydown', (e)=> { if(e.key==='Enter'){ addTask(newTask.value.trim()); newTask.value=''; }});
document.getElementById('save').addEventListener('click', ()=>{ prefs.work = parseInt(document.getElementById('sWork').value) || prefs.work; prefs.short = parseInt(document.getElementById('sShort').value) || prefs.short; prefs.long = parseInt(document.getElementById('sLong').value) || prefs.long; setMode('work'); saveAll(); alert('Saved'); });
document.getElementById('clear').addEventListener('click', ()=>{ if(confirm('Reset all data?')){ localStorage.removeItem(KEY); localStorage.removeItem(KEY + '-tasks'); location.reload(); }});
focusToggle.addEventListener('change', ()=> applyFocus(false));
exportBtn.addEventListener('click', ()=> { const rows = getTasks().map(t=> `${t.id},"${t.title.replace(/"/g,'""')}",${t.pomodoros||0},${t.done},${new Date(t.created).toISOString()}`).join('\n'); const csv = 'id,title,pomodoros,done,created\n' + rows; const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'pomodoro_tasks.csv'; a.click(); URL.revokeObjectURL(url); });

/* ---------- Sand control helpers (reset) ---------- */
function resetSand(){
  // instant reset visuals
  sandFillTop.style.height = '50%';
  sandFillBottom.style.height = '0%';
  sandStream.style.height = '0%';
  sandStream.style.opacity = '0';
}

/* ---------- Init ---------- */
function init(){
  document.getElementById('sWork').value = prefs.work;
  document.getElementById('sShort').value = prefs.short;
  document.getElementById('sLong').value = prefs.long;
  setMode('work');
  const loaded = localStorage.getItem(KEY);
  if(loaded){
    try{ const p = JSON.parse(loaded); sessionsToday = p.sessionsToday || sessionsToday; streak = p.streak || streak; weekly = p.weekly || weekly; }catch(e){}
  }
  renderTasks();
  updateAllUI();
}
init();

/* ---------- Autosave ---------- */
setInterval(saveAll, 5000);
window.addEventListener('beforeunload', ()=> saveAll());

</script>
</body>
</html>
