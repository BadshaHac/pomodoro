<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cyberpunk Pomodoro Timer</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Roboto:wght@400;700&display=swap');

  :root {
    --dark-bg: #0d1117;
    --neon-cyan: #00fff7;
    --neon-magenta: #ff00f7;
    --neon-purple: #9d5fff;
    --glass-bg: rgba(30, 30, 30, 0.6);
    --glass-border: rgba(0, 255, 255, 0.4);
    --font-main: 'Orbitron', monospace;
    --font-secondary: 'Roboto', sans-serif;
  }

  * {
    box-sizing: border-box;
    user-select: none;
  }

  body {
    margin: 0;
    background: var(--dark-bg);
    color: var(--neon-cyan);
    font-family: var(--font-secondary);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
  }

  .container {
    display: flex;
    background: var(--glass-bg);
    border-radius: 20px;
    box-shadow:
      0 0 5px var(--neon-cyan),
      0 0 20px var(--neon-magenta),
      0 0 40px var(--neon-purple);
    backdrop-filter: blur(12px);
    border: 2px solid var(--glass-border);
    width: 900px;
    height: 480px;
    padding: 30px;
    gap: 30px;
  }

  .timer-side {
    flex: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .sand-timer-svg {
    width: 280px;
    filter: drop-shadow(0 0 8px var(--neon-cyan));
  }

  .timer-display {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: var(--font-main);
    font-size: 96px;
    color: var(--neon-magenta);
    text-shadow:
      0 0 6px var(--neon-magenta),
      0 0 14px var(--neon-magenta),
      0 0 24px var(--neon-magenta);
    user-select: none;
  }

  .modes {
    margin-top: 25px;
    display: flex;
    gap: 25px;
  }

  .mode-btn {
    font-family: var(--font-main);
    font-weight: 700;
    font-size: 18px;
    background: transparent;
    border: 2px solid var(--neon-cyan);
    border-radius: 12px;
    padding: 12px 22px;
    color: var(--neon-cyan);
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
  }

  .mode-btn.active,
  .mode-btn:hover {
    background: var(--neon-magenta);
    border-color: var(--neon-magenta);
    color: #111;
    box-shadow:
      0 0 8px var(--neon-magenta),
      0 0 18px var(--neon-magenta);
  }

  .controls {
    margin-top: 30px;
    display: flex;
    gap: 25px;
  }

  .control-btn {
    border: none;
    background: var(--neon-cyan);
    padding: 14px 28px;
    border-radius: 18px;
    color: #111;
    font-family: var(--font-main);
    font-weight: 700;
    font-size: 18px;
    cursor: pointer;
    box-shadow:
      0 0 10px var(--neon-cyan);
    transition: box-shadow 0.3s ease;
  }

  .control-btn:hover {
    box-shadow:
      0 0 20px var(--neon-magenta);
    background: var(--neon-magenta);
    color: #fff;
  }

  .stats-side {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
    color: var(--neon-cyan);
    font-family: var(--font-secondary);
  }

  .stats-title {
    text-transform: uppercase;
    font-weight: 700;
    font-size: 24px;
    letter-spacing: 2px;
    margin-bottom: 20px;
    color: var(--neon-magenta);
  }

  .stat-item {
    background: var(--glass-bg);
    padding: 20px;
    border-radius: 15px;
    border: 2px solid var(--glass-border);
    box-shadow:
      0 0 10px var(--neon-cyan);
    display: flex;
    justify-content: space-between;
    font-size: 20px;
  }

  /* Custom timer form */
  .custom-timer {
    margin-top: 40px;
    padding: 20px;
    background: var(--glass-bg);
    border-radius: 16px;
    border: 2px solid var(--glass-border);
    box-shadow:
      0 0 10px var(--neon-magenta);
    color: var(--neon-cyan);
    font-family: var(--font-secondary);
  }

  .custom-label {
    font-weight: 600;
    margin-bottom: 10px;
    display: block;
    letter-spacing: 1.2px;
  }

  .custom-input {
    width: 100%;
    padding: 10px;
    border-radius: 10px;
    background: #111;
    border: 1px solid var(--neon-cyan);
    color: var(--neon-cyan);
    font-size: 16px;
    font-family: var(--font-secondary);
    box-shadow:
      inset 0 0 8px var(--neon-cyan);
  }

  .custom-submit {
    margin-top: 15px;
    background: var(--neon-purple);
    border: none;
    border-radius: 12px;
    padding: 12px 22px;
    color: #111;
    font-weight: 700;
    text-transform: uppercase;
    cursor: pointer;
    transition: box-shadow 0.3s ease;
    font-family: var(--font-main);
  }

  .custom-submit:hover {
    box-shadow:
      0 0 16px var(--neon-magenta);
  }

  /* Sand timer animation */
  .sand-fill-top,
  .sand-fill-bottom {
    transform-origin: center;
    animation-timing-function: linear;
  }

  /* Sand falling animation */
  @keyframes sandFall {
    0% { opacity: 0; transform: translateY(-10px) scaleY(0.7);}
    50% { opacity: 1; transform: translateY(0) scaleY(1);}
    100% { opacity: 0; transform: translateY(10px) scaleY(0.8);}
  }

  .sand-falling-line {
    animation-name: sandFall;
    animation-iteration-count: infinite;
    animation-duration: 1s;
  }

</style>
</head>
<body>
<div class="container">

  <div class="timer-side" role="region" aria-label="Pomodoro Timer">
    <svg class="sand-timer-svg" viewBox="0 0 128 256" aria-hidden="true" >
      <defs>
        <linearGradient id="glassGradient" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="var(--neon-cyan)" stop-opacity="0.8"/>
          <stop offset="100%" stop-color="var(--neon-magenta)" stop-opacity="0.8"/>
        </linearGradient>
        <linearGradient id="sandTop" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="var(--neon-magenta)" stop-opacity="0.9"/>
          <stop offset="100%" stop-color="var(--neon-magenta)" stop-opacity="0.3"/>
        </linearGradient>
        <linearGradient id="sandBottom" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="var(--neon-cyan)" stop-opacity="0.4"/>
          <stop offset="100%" stop-color="var(--neon-cyan)" stop-opacity="0.9"/>
        </linearGradient>
      </defs>
      <!-- Outer glass frame -->
      <rect x="14" y="11" rx="20" ry="20" width="100" height="234"
        fill="none" stroke="url(#glassGradient)" stroke-width="6" />
      <!-- Top sand -->
      <rect class="sand-fill-top" x="26" y="24" width="76" height="40" fill="url(#sandTop)" />
      <!-- Falling sand -->
      <line class="sand-falling-line" x1="64" y1="64" x2="64" y2="80"
        stroke="url(#glassGradient)" stroke-width="4" stroke-linecap="round"/>
      <!-- Bottom sand -->
      <rect class="sand-fill-bottom" x="26" y="162" width="76" height="26" fill="url(#sandBottom)" />
      <!-- Inner frame neck -->
      <rect x="44" y="63" width="40" height="32" fill="var(--dark-bg)" />
    </svg>
    <div class="timer-display" id="timer">
      25:00
    </div>

    <div class="modes" role="group" aria-label="Timer modes">
      <button class="mode-btn active" id="focus-btn" aria-pressed="true">Focus</button>
      <button class="mode-btn" id="short-btn" aria-pressed="false">Break</button>
      <button class="mode-btn" id="long-btn" aria-pressed="false">Long Break</button>
      <button class="mode-btn" id="custom-btn" aria-pressed="false">Custom</button>
    </div>

    <div class="controls" role="group" aria-label="Timer controls">
      <button class="control-btn" id="start-pause-btn">Start</button>
      <button class="control-btn" id="reset-btn">Reset</button>
    </div>

    <form class="custom-timer" id="custom-timer-form" aria-label="Custom timer input" hidden>
      <label for="custom-minutes" class="custom-label">Custom Timer (minutes)</label>
      <input
        type="number"
        id="custom-minutes"
        class="custom-input"
        min="1"
        max="120"
        value="25"
        aria-describedby="custom-help"
      />
      <small id="custom-help">Choose between 1 and 120 minutes</small>
      <button type="submit" class="custom-submit">Set Custom Timer</button>
    </form>

  </div>

  <aside class="stats-side" aria-label="Timer stats">
    <h2 class="stats-title">Stats</h2>
    <div class="stat-item"><span>Pomodoros Done</span><span id="pomodoro-count">0</span></div>
    <div class="stat-item"><span>Total Focus Time</span><span id="total-focus">0</span> min</div>
    <div class="stat-item"><span>Current Streak</span><span id="streak">0</span></div>
  </aside>

</div>

<script>
  const MODES = {
    focus: { minutes: 25 },
    shortBreak: { minutes: 5 },
    longBreak: { minutes: 25 * 4 },
    custom: { minutes: 25 }
  };

  let currentMode = 'focus';
  let timerMinutes = MODES[currentMode].minutes;
  let timerSeconds = 0;
  let timerInterval = null;
  let running = false;
  let pomodoroCount = 0;
  let streakCount = 0;
  let totalFocusMinutes = 0;

  const timerEl = document.getElementById('timer');
  const pomodoroCountEl = document.getElementById('pomodoro-count');
  const totalFocusEl = document.getElementById('total-focus');
  const streakEl = document.getElementById('streak');

  const focusBtn = document.getElementById('focus-btn');
  const shortBtn = document.getElementById('short-btn');
  const longBtn = document.getElementById('long-btn');
  const customBtn = document.getElementById('custom-btn');

  const startPauseBtn = document.getElementById('start-pause-btn');
  const resetBtn = document.getElementById('reset-btn');
  const customTimerForm = document.getElementById('custom-timer-form');
  const customMinutesInput = document.getElementById('custom-minutes');

  const sandFillTop = document.querySelector('.sand-fill-top');
  const sandFillBottom = document.querySelector('.sand-fill-bottom');
  const sandFallingLine = document.querySelector('.sand-falling-line');

  // Update the timer display
  function updateTimerDisplay() {
    let min = timerMinutes.toString().padStart(2, '0');
    let sec = timerSeconds.toString().padStart(2, '0');
    timerEl.textContent = `${min}:${sec}`;
  }

  // Calculate sand fill heights and animate accordingly
  function updateSandAnimation() {
    // Progress from 0 (start) to 1 (end)
    const totalSeconds = MODES[currentMode].minutes * 60;
    const elapsedSeconds = (MODES[currentMode].minutes * 60 - (timerMinutes * 60 + timerSeconds));
    const progress = elapsedSeconds / totalSeconds;

    // Sand top shrinks, bottom grows
    const topMaxHeight = 40;  // defined in SVG for top rectangle
    const bottomMaxHeight = 26;  // defined for bottom

    sandFillTop.style.height = (topMaxHeight * (1 - progress)) + "px";
    sandFillBottom.style.height = (bottomMaxHeight * progress) + "px";

    // Animate falling sand line: blink faster towards end
    const fallDuration = 1000; // ms
    const fallInterval = fallDuration / (progress * 10 + 1);
    sandFallingLine.style.animationDuration = fallInterval + "ms";
    sandFallingLine.style.animationPlayState = running ? 'running' : 'paused';
  }

  function setMode(mode) {
    currentMode = mode;
    if (mode === 'custom') {
      customTimerForm.hidden = false;
      timerMinutes = Number(customMinutesInput.value);
    } else {
      customTimerForm.hidden = true;
      timerMinutes = MODES[mode].minutes;
    }
    timerSeconds = 0;
    running = false;
    clearInterval(timerInterval);
    startPauseBtn.textContent = "Start";
    updateTimerDisplay();
    updateSandAnimation();
    updateActiveButtons();
  }

  function updateActiveButtons() {
    [focusBtn, shortBtn, longBtn, customBtn].forEach(btn => {
      btn.classList.remove('active');
      btn.setAttribute('aria-pressed', 'false');
    });
    switch (currentMode) {
      case 'focus':
        focusBtn.classList.add('active');
        focusBtn.setAttribute('aria-pressed', 'true');
        break;
      case 'shortBreak':
        shortBtn.classList.add('active');
        shortBtn.setAttribute('aria-pressed', 'true');
        break;
      case 'longBreak':
        longBtn.classList.add('active');
        longBtn.setAttribute('aria-pressed', 'true');
        break;
      case 'custom':
        customBtn.classList.add('active');
        customBtn.setAttribute('aria-pressed', 'true');
        break;
    }
  }

  function startTimer() {
    if (running) {
      clearInterval(timerInterval);
      running = false;
      startPauseBtn.textContent = "Start";
      stopTickSound();
      return;
    }

    running = true;
    startPauseBtn.textContent = "Pause";
    playStartSound();

    timerInterval = setInterval(() => {
      if (timerSeconds === 0) {
        if (timerMinutes === 0) {
          clearInterval(timerInterval);
          running = false;
          startPauseBtn.textContent = "Start";
          playCompleteSound();
          // Update stats for focus sessions only
          if (currentMode === 'focus' || currentMode === 'custom') {
            pomodoroCount += 1;
            streakCount += 1;
            totalFocusMinutes += MODES[currentMode].minutes;
            pomodoroCountEl.textContent = pomodoroCount;
            streakEl.textContent = streakCount;
            totalFocusEl.textContent = totalFocusMinutes;
          }
          // Auto switch to break or focus depending on mode
          if (currentMode === 'focus') {
            setMode('shortBreak');
          } else if (currentMode === 'shortBreak') {
            if ((pomodoroCount % 4) === 0) {
              setMode('longBreak');
            } else {
              setMode('focus');
            }
          } else if (currentMode === 'longBreak') {
            setMode('focus');
          }
          stopTickSound();
          return;
        } else {
          timerMinutes--;
          timerSeconds = 59;
        }
      } else {
        timerSeconds--;
      }
      updateTimerDisplay();
      updateSandAnimation();
      playTickSound(timerMinutes, timerSeconds);
    }, 1000);
  }

  function resetTimer() {
    clearInterval(timerInterval);
    running = false;
    if (currentMode === 'custom') {
      timerMinutes = Number(customMinutesInput.value);
    } else {
      timerMinutes = MODES[currentMode].minutes;
    }
    timerSeconds = 0;
    startPauseBtn.textContent = "Start";
    updateTimerDisplay();
    updateSandAnimation();
    stopTickSound();
  }

  // SOUND EFFECTS
  let tickAudioCtx = null;
  let tickOscillator = null;
  let tickGain = null;

  function playTickSound(min, sec) {
    if (!running) return;
    if (min === 0 && sec <= 10) {
      if (!tickAudioCtx) {
        tickAudioCtx = new AudioContext();
        tickOscillator = tickAudioCtx.createOscillator();
        tickGain = tickAudioCtx.createGain();
        tickOscillator.frequency.value = 880;
        tickOscillator.type = 'square';
        tickGain.gain.value = 0;
        tickOscillator.connect(tickGain);
        tickGain.connect(tickAudioCtx.destination);
        tickOscillator.start();
      }
      tickGain.gain.cancelScheduledValues(tickAudioCtx.currentTime);
      tickGain.gain.setValueAtTime(0.1, tickAudioCtx.currentTime);
      tickGain.gain.setTargetAtTime(0, tickAudioCtx.currentTime + 0.1, 0.01);
    } else {
      stopTickSound();
    }
  }

  function stopTickSound() {
    if (tickGain) tickGain.gain.setTargetAtTime(0, tickAudioCtx.currentTime, 0.02);
  }

  function playStartSound() {
    const ctx = new AudioContext();
    const startOsc = ctx.createOscillator();
    const gainNode = ctx.createGain();
    startOsc.type = 'triangle';
    startOsc.frequency.setValueAtTime(440, ctx.currentTime);
    gainNode.gain.setValueAtTime(0.2, ctx.currentTime);
    startOsc.connect(gainNode);
    gainNode.connect(ctx.destination);
    startOsc.start();
    startOsc.stop(ctx.currentTime + 0.18);
  }

  function playCompleteSound() {
    const ctx = new AudioContext();
    const noteTime = 0.18;
    const gainNode = ctx.createGain();
    gainNode.gain.setValueAtTime(0.15, ctx.currentTime);
    gainNode.connect(ctx.destination);

    function playNote(freq, delay) {
      const osc = ctx.createOscillator();
      osc.type = 'sine';
      osc.frequency.setValueAtTime(freq, ctx.currentTime + delay);
      osc.connect(gainNode);
      osc.start(ctx.currentTime + delay);
      osc.stop(ctx.currentTime + delay + noteTime);
    }

    // 4-note ascending melody: C5 - D5 - E5 - G5
    playNote(523.25, 0);
    playNote(587.33, noteTime);
    playNote(659.25, noteTime * 2);
    playNote(783.99, noteTime * 3);
  }

  // Event listeners for buttons
  focusBtn.onclick = () => setMode('focus');
  shortBtn.onclick = () => setMode('shortBreak');
  longBtn.onclick = () => setMode('longBreak');
  customBtn.onclick = () => setMode('custom');

  startPauseBtn.onclick = () => {
    if (!running) startTimer();
    else {
      clearInterval(timerInterval);
      running = false;
      startPauseBtn.textContent = "Start";
      stopTickSound();
    }
  };

  resetBtn.onclick = resetTimer;

  customTimerForm.onsubmit = (e) => {
    e.preventDefault();
    let val = Number(customMinutesInput.value);
    if (val < 1 || val > 120) {
      alert("Please enter a value between 1 and 120.");
      return;
    }
    MODES.custom.minutes = val;
    setMode("custom");
  };

  // Initialize
  setMode('focus');
</script>
</body>
</html>
